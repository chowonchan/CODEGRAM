<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: #fafafa;
    }

    .memberId {
      margin: 10px 20px;
    }

    .sendMessage2 {
      float: right;
      border: none;
      cursor: pointer;
    }

    .MessageTitle {
      margin: 10px 20px;
    }


    /* ------------------------------------------------- */

    /* 채팅창 영역 */
    .chatting-area {
      margin: auto;
      height: 100vh;
      width: 100%;
      /* margin-top: 20px;
  margin-bottom: 50px; */
      display: flex;
      ;
    }

    /*  채팅 목록 */
    .chatting-list {
      background: white;
      border: 1px solid #dbdbdb;
      border-radius: 8px;
      width: 30%;

      list-style: none;
      overflow: auto;
    }

    .chatting-item {
      height: 12%;
      display: flex;
      padding: 5px 0;
      border-bottom: 1px solid black;
      cursor: pointer;
    }

    .chatting-item * {
      pointer-events: none;
    }

    .chatting-item>div {
      height: 100%;
      text-align: center;
    }

    .item-header {
      width: 25%;
    }

    .item-body {
      width: 75%;
      padding: 2px 0;
    }

    .item-body>p {
      display: flex;
      justify-content: space-between;
    }

    .chatting-item.select {
      background-color: #ddd;
    }


    .list-profile {
      max-width: 65px;
      max-height: 65px;
    }

    .target-name {
      font-size: 1.2em;
      font-weight: bold;
    }

    .recent-send-time {
      margin-right: 5px;
    }


    .item-body>div {
      display: flex;
      justify-content: space-between;
    }

    .recent-message {
      width: 180px;

      /* 여러 줄 말줄임 처리 */
      white-space: normal;
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;

      /*  줄바꿈 처리 */
      word-break: break-all;
    }





    /* ------------------------------------------------- */







    .chat-container {
      /* max-width: 100%; */
      width: 100%;
      /* margin: 20px auto; */
      background: white;
      border: 1px solid #dbdbdb;
      border-radius: 8px;
      height: 100vh;
      display: flex;

      align-items: center;
      justify-content: center;
      flex-direction: column;
    }

    .DMLogo {
      /* align-items: center;
      justify-content: center;
      display: flex; */
      float: center;
    }

    .my-message {
      align-items: center;
      justify-content: center;
      display: flex;
      margin-bottom: 10px;
    }

    .sendMessage {
      align-items: center;
      justify-content: center;
      display: flex;

      width: 120px;
      /* 수평 중앙 정렬 */
      padding: 10px 0;
      background-color: rgb(14, 148, 237);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 10px;
    }

    .chat-header {
      padding: 16px;
      border-bottom: 1px solid #dbdbdb;
      display: flex;
      align-items: center;
    }

    .profile-image {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #eee;
      margin-right: 12px;
    }

    .username {
      font-weight: 600;
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .message {
      max-width: 60%;
      padding: 8px 12px;
      border-radius: 22px;
      font-size: 14px;
      word-break: break-word;
    }

    .message.received {
      background: #efefef;
      align-self: flex-start;
    }

    .message.sent {
      background: #3897f0;
      color: white;
      align-self: flex-end;
    }

    .message-image {
      max-width: 200px;
      border-radius: 12px;
      margin: 4px 0;
    }

    .chat-input {
      padding: 16px;
      border-top: 1px solid #dbdbdb;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .message-input {
      flex: 1;
      border: 1px solid #dbdbdb;
      border-radius: 22px;
      padding: 8px 16px;
      font-size: 14px;
      outline: none;
    }

    .image-upload {
      display: none;
    }

    .upload-label {
      cursor: pointer;
      color: #3897f0;
    }

    .send-button {
      background: none;
      border: none;
      color: #3897f0;
      font-weight: 600;
      cursor: pointer;
    }

    .send-button:disabled {
      color: #b3dffc;
      cursor: default;
    }

    .image-preview {
      max-width: 100px;
      max-height: 100px;
      object-fit: cover;
      border-radius: 8px;
      display: none;
    }









    /* -------------------  메시지 보내기 css -------------------*/

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }

    /* 메시지 보내기 모달창 기본 숨기기 */
    #chattingSearchMember {
      display: none;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.65);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-container {
      background-color: white;
      width: 100%;
      max-width: 500px;
      border-radius: 12px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      height: 400px;
    }

    .modal-header {
      padding: 10px 16px;
      border-bottom: 1px solid #dbdbdb;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-size: 16px;
      font-weight: 600;
      flex: 1;
      text-align: center;
    }

    .close-button {
      border: none;
      background: none;
      cursor: pointer;
      font-size: 18px;
      padding: 5px;
    }

    .modal-search {
      padding: 8px 16px;
      border-bottom: 1px solid #dbdbdb;
    }

    .search-label {
      display: block;
      color: #262626;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .search-input {
      width: 100%;
      padding: 8px;
      border: 1px solid #dbdbdb;
      border-radius: 6px;
      font-size: 14px;
      outline: none;
    }

    .search-input:focus {
      border-color: #a8a8a8;
    }

    .modal-content {
      flex: 1;
      overflow-y: auto;
      padding: 8px 0;
    }

    .no-results {
      padding: 16px;
      text-align: center;
      color: #8e8e8e;
      font-size: 14px;
    }

    .modal-footer {
      padding: 8px 16px;
      border-top: 1px solid #dbdbdb;
    }

    .send-button {
      width: 100%;
      padding: 7px 16px;
      background-color: #0095f6;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      opacity: 0.3;
    }

    .send-button:disabled {
      opacity: 0.3;
      cursor: default;
    }
  </style>

  <!-- <link rel="stylesheet" href="/css/chatting/chatting.css"> -->
</head>

<body>

  <th:block th:replace="~{common/sideMenu}"></th:block>

  <div class="chatting-area">
    <ul class="chatting-list">

      <th:block th:each="chatRoom : ${chatRoomList}">
        <h2 class="memberId" th:text="${session.memberId}">내 아이디
          <button class="sendMessage2"><img src="writeBtn.png"></button>
        </h2>


        <br>

        <h3 class="MessageTitle">메시지</h3>
        <!-- th:chat-no : li 태그에 임의의 속성 chat-no를 추가하는데
                  타임리프를 이용해 출력된 값을 chat-no 속성 값으로 대입 -->
        <li class="chatting-item" th:chat-no="${chatRoom.chatRoomNo}" th:target-no="${chatRoom.targetNo}">
          <div class="item-header">

            <img th:if="${chatRoom.targetProfile}" class="list-profile" th:src="${chatRoom.targetProfile}">

            <img th:unless="${chatRoom.targetProfile}" class="list-profile" th:src="#{user.default.image}">

          </div>
          <div class="item-body">
            <p>
              <span class="target-name" th:text="${chatRoom.targetNickname}">상대방 이름</span>
              <span class="recent-send-time" th:text="${chatRoom.sendTime}">메세지 보낸 시간</span>
            </p>
            <div>
              <p class="recent-message" th:text="${chatRoom.lastMessage}">메세지 내용</p>

              <p th:if="${chatRoom.notReadCount > 0}" class="not-read-count" th:text="${chatRoom.notReadCount}"></p>
            </div>
          </div>
        </li>

      </th:block>
    </ul>


    <div class="chat-container">

      <div>
        <img src="DM로고.png" class="DMLogo">
        <h2 class="my-message">내 메시지</h2>
        <h4>친구나 그룹에 비공개 사진과 메시지를 보내 보세요</h4>
      </div>

      <button class="sendMessage">메시지 보내기</button>



      <!-- 메시지들이 여기에 추가됩니다 -->
      <!-- <div class="chat-messages" id="chatMessages" th:chat-no="${chatRoom.chattingchatRoomNo}" th:target-no="${chatRoom.targetNo}">
      </div> -->

      <!-- <div class="chat-input">
        <label class="upload-label" for="imageUpload">📷</label>
        <input type="file" id="imageUpload" class="image-upload" accept="image/*">
        <img id="imagePreview" class="image-preview">
        <input type="text" class="message-input" id="messageInput" placeholder="메시지 보내기...">
        <button class="send-button" id="sendButton">보내기</button>
      </div> -->


    </div>
  </div>


  <div class="modal-overlay" id="chattingSearchMember">
    <div class="modal-container">
      <div class="modal-header">
        <div class="modal-title">새로운 메시지</div>
        <div style="width: 24px;"></div>
        <button class="close-button">✕</button>
      </div>

      <div class="modal-search">
        <label class="search-label">받는 사람:</label>
        <input type="text" class="search-input" placeholder="검색..." autocomplete="off">
      </div>

      <div class="modal-content">
        <div class="no-results">제안을 찾을 수 없습니다.</div>
        <div class="search-results"></div>
      </div>

      <div class="modal-footer">
        <button class="send-button" disabled>채팅</button>
      </div>
    </div>
  </div>







  <th:block th:replace="~{chatting/chattingSearchMember}"></th:block>

  <script>

    const sendMessage = document.querySelector(".sendMessage");
    const sendMessage2 = document.querySelector(".sendMessage2");
    sendMessage.addEventListener("click", () => {
      chattingSearchMember.style.display = "flex";
    });

    sendMessage2.addEventListener("click", () => {
      chattingSearchMember.style.display = "flex";
    });




    /* ---------------------- 메시지 보내기 js ------------------ */
    const members = [
      { memberId: 1, memberName: 'member01', memberNickName: '홍길동', profileImg: '/api/placeholder/36/36' },
      { memberId: 2, memberName: 'member02', memberNickName: '김철수', profileImg: '/api/placeholder/36/36' },
      { memberId: 3, memberName: 'member03', memberNickName: '박지영', profileImg: '/api/placeholder/36/36' },
      { memberId: 4, memberName: 'member04', memberNickName: '최예림', profileImg: '/api/placeholder/36/36' },
    ];

    document.querySelector('.close-button').addEventListener('click', () => {
      document.querySelector('.modal-overlay').style.display = 'none';
    });

    const searchInput = document.querySelector('.search-input');
    const sendButton = document.querySelector('.send-button');
    const searchResults = document.querySelector('.search-results');
    const noResultsMessage = document.querySelector('.no-results');

    searchInput.addEventListener('input', (e) => {
      const query = e.target.value.trim().toLowerCase();
      if (query) {
        const filteredMembers = members.filter(member =>
          member.memberName.toLowerCase().includes(query) ||
          member.memberNickName.toLowerCase().includes(query)
        );

        if (filteredMembers.length > 0) {
          searchResults.innerHTML = filteredMembers.map(member => `
              <div class="profile-item" data-memberId="${member.memberId}">
                  <img src="${member.profileImg}" alt="${member.memberNickName}">
                  <div>
                      <div class="memberNickName">${member.memberNickName}</div>
                      <div class="memberName">@${member.memberName}</div>
                  </div>
              </div>
          `).join('');
          noResultsMessage.style.display = 'none';
        } else {
          noResultsMessage.style.display = 'block';
          searchResults.innerHTML = '';
        }
      } else {
        searchResults.innerHTML = '';
        noResultsMessage.style.display = 'block';
      }

      sendButton.disabled = !query;
      sendButton.style.opacity = query ? '1' : '0.3';
    });

    searchResults.addEventListener('click', (e) => {
      const selectedmember = e.target.closest('.profile-item');
      if (selectedmember) {
        sendButton.disabled = false;
        sendButton.style.opacity = '1';
      }
    });
  </script>

</body>

</html>