<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: #fafafa;
    }

    .memberId {
      margin: 10px 20px;
    }

    .MessageTitle {
      margin: 10px 20px;
    }


    /* ------------------------------------------------- */

    /* 채팅창 영역 */
    .chatting-area {
      margin: auto;
      height: 100vh;
      width: 100%;
      /* margin-top: 20px;
      margin-bottom: 50px; */
      display: flex;
      ;
    }

    /*  채팅 목록 */
    .chatting-list {
      background: white;
      border: 1px solid #dbdbdb;
      border-radius: 8px;
      width: 30%;

      list-style: none;
      overflow: auto;
    }

    .chatting-item {
      height: 12%;
      display: flex;
      padding: 5px 0;
      border-bottom: 1px solid black;
      cursor: pointer;
    }

    .chatting-item * {
      pointer-events: none;
    }

    .chatting-item>div {
      height: 100%;
      text-align: center;
    }

    .item-header {
      width: 25%;
    }

    .item-body {
      width: 75%;
      padding: 2px 0;
    }

    .item-body>p {
      display: flex;
      justify-content: space-between;
    }

    .chatting-item.select {
      background-color: #ddd;
    }


    .list-profile {
      max-width: 65px;
      max-height: 65px;
    }

    .target-name {
      font-size: 1.2em;
      font-weight: bold;
    }

    .recent-send-time {
      margin-right: 5px;
    }


    .item-body>div {
      display: flex;
      justify-content: space-between;
    }

    .recent-message {
      width: 180px;

      /* 여러 줄 말줄임 처리 */
      white-space: normal;
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;

      /*  줄바꿈 처리 */
      word-break: break-all;
    }





    /* ------------------------------------------------- */


    .send-message {
      align-items: center;
      justify-content: center;
      /* 수평 중앙 정렬 */
      padding: 10px 15px;
      background-color: rgb(14, 148, 237);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }





    .chat-container {
      /* max-width: 100%; */
      width: 100%;
      /* margin: 20px auto; */
      background: white;
      border: 1px solid #dbdbdb;
      border-radius: 8px;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .chat-header {
      padding: 16px;
      border-bottom: 1px solid #dbdbdb;
      display: flex;
      align-items: center;
    }

    .profile-image {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #eee;
      margin-right: 12px;
    }

    .username {
      font-weight: 600;
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .message {
      max-width: 60%;
      padding: 8px 12px;
      border-radius: 22px;
      font-size: 14px;
      word-break: break-word;
    }

    .message.received {
      background: #efefef;
      align-self: flex-start;
    }

    .message.sent {
      background: #3897f0;
      color: white;
      align-self: flex-end;
    }

    .message-image {
      max-width: 200px;
      border-radius: 12px;
      margin: 4px 0;
    }

    .chat-input {
      padding: 16px;
      border-top: 1px solid #dbdbdb;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .message-input {
      flex: 1;
      border: 1px solid #dbdbdb;
      border-radius: 22px;
      padding: 8px 16px;
      font-size: 14px;
      outline: none;
    }

    .image-upload {
      display: none;
    }

    .upload-label {
      cursor: pointer;
      color: #3897f0;
    }

    .send-button {
      background: none;
      border: none;
      color: #3897f0;
      font-weight: 600;
      cursor: pointer;
    }

    .send-button:disabled {
      color: #b3dffc;
      cursor: default;
    }

    .image-preview {
      max-width: 100px;
      max-height: 100px;
      object-fit: cover;
      border-radius: 8px;
      display: none;
    }
  </style>
</head>

<body>

  <th:block th:replace="~{common/sideMenu}"></th:block>

  <div class="chatting-area">
    <ul class="chatting-list">

      <th:block th:each="room : ${roomList}">
        <h2 class="memberId" th:text="${session.memberId}">내 아이디</h2>

        <br>

        <h3 class="MessageTitle">메시지</h3>
        <!-- th:chat-no : li 태그에 임의의 속성 chat-no를 추가하는데
                  타임리프를 이용해 출력된 값을 chat-no 속성 값으로 대입 -->
        <li class="chatting-item" th:chat-no="${room.chattingRoomNo}" th:target-no="${room.targetNo}">
          <div class="item-header">

            <img th:if="${room.targetProfile}" class="list-profile" th:src="${room.targetProfile}">

            <img th:unless="${room.targetProfile}" class="list-profile" th:src="#{user.default.image}">

          </div>
          <div class="item-body">
            <p>
              <span class="target-name" th:text="${room.targetNickname}">상대방 이름</span>
              <span class="recent-send-time" th:text="${room.sendTime}">메세지 보낸 시간</span>
            </p>
            <div>
              <p class="recent-message" th:text="${room.lastMessage}">메세지 내용</p>

              <p th:if="${room.notReadCount > 0}" class="not-read-count" th:text="${room.notReadCount}"></p>
            </div>
          </div>
        </li>

      </th:block>
    </ul>


    <div class="chat-container">



      <div class="chat-messages" id="chatMessages" th:chat-no="${room.chattingRoomNo}" th:target-no="${room.targetNo}">
        <!-- 메시지들이 여기에 추가됩니다 -->
      </div>

      <div class="chat-input">
        <label class="upload-label" for="imageUpload">📷</label>
        <input type="file" id="imageUpload" class="image-upload" accept="image/*">
        <img id="imagePreview" class="image-preview">
        <input type="text" class="message-input" id="messageInput" placeholder="메시지 보내기...">
        <button class="send-button" id="sendButton">보내기</button>
      </div>
    </div>
  </div>

</body>

</html>